"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var ramda=require("ramda"),extendStatics=function(r,e){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,e){r.__proto__=e}||function(r,e){for(var t in e)e.hasOwnProperty(t)&&(r[t]=e[t])})(r,e)};function __extends(r,e){function t(){this.constructor=r}extendStatics(r,e),r.prototype=null===e?Object.create(e):(t.prototype=e.prototype,new t)}var __assign=function(){return(__assign=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++)for(var i in e=arguments[t])Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=e[i]);return r}).apply(this,arguments)};function __awaiter(r,e,t,n){return new(t||(t=Promise))(function(i,a){function o(r){try{u(n.next(r))}catch(r){a(r)}}function c(r){try{u(n.throw(r))}catch(r){a(r)}}function u(r){r.done?i(r.value):new t(function(e){e(r.value)}).then(o,c)}u((n=n.apply(r,e||[])).next())})}function __generator(r,e){var t,n,i,a,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function c(a){return function(c){return function(a){if(t)throw new TypeError("Generator is already executing.");for(;o;)try{if(t=1,n&&(i=2&a[0]?n.return:a[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,a[1])).done)return i;switch(n=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,n=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(i=(i=o.trys).length>0&&i[i.length-1])&&(6===a[0]||2===a[0])){o=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){o.label=a[1];break}if(6===a[0]&&o.label<i[1]){o.label=i[1],i=a;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(a);break}i[2]&&o.ops.pop(),o.trys.pop();continue}a=e.call(r,o)}catch(r){a=[6,r],n=0}finally{t=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,c])}}}var _this=null,addHeaders=ramda.curry(function(r,e){return __assign({},e,{headers:Object.assign({},e.headers,r)})}),forEach=function(){var r=function(e,t,n){return __awaiter(_this,void 0,void 0,function(){return __generator(this,function(i){switch(i.label){case 0:return n<t.length?[4,e(t[n])]:[3,3];case 1:return i.sent(),[4,r(e,t,++n)];case 2:i.sent(),i.label=3;case 3:return[2]}})})};return ramda.curry(function(e,t){return r(e,t,0)})}(),forEachAsync=ramda.curry(function(r,e){return Promise.all(e.map(r))}),waitAll=function(r){return Promise.all(r)},explore=ramda.tap(ramda.bind(console.log,console)),clearEmpty=ramda.pickBy(ramda.unary(ramda.complement(ramda.isEmpty))),bind=function(r,e){return ramda.curry(r[e].bind(r))},mapKeys=ramda.curry(function(r,e){return ramda.compose(ramda.fromPairs,ramda.filter(ramda.complement(ramda.isNil)),ramda.map(function(e){var t=e[0],n=e[1];return null===r[t]?null:[r[t]||t,n]}),ramda.toPairs)(e)}),asyncpipe=function(){var r=function(e,t,n){return __awaiter(_this,void 0,Promise,function(){var i,a,o,c;return __generator(this,function(u){switch(u.label){case 0:return~n?(i=e[n](t),a=r,o=[e],i instanceof Promise?[4,i]:[3,2]):[3,5];case 1:return c=u.sent(),[3,3];case 2:c=i,u.label=3;case 3:return[4,a.apply(void 0,o.concat([c,--n]))];case 4:return[2,u.sent()];case 5:return[2,t]}})})};return function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return function(t){return r(e,t,e.length-1)}}}();function _isPlaceholder(r){return null!=r&&"object"==typeof r&&!0===r["@@functional/placeholder"]}var _isPlaceholder_1=_isPlaceholder;function _curry1(r){return function e(t){return 0===arguments.length||_isPlaceholder_1(t)?e:r.apply(this,arguments)}}var _curry1_1=_curry1;function _curry2(r){return function e(t,n){switch(arguments.length){case 0:return e;case 1:return _isPlaceholder_1(t)?e:_curry1_1(function(e){return r(t,e)});default:return _isPlaceholder_1(t)&&_isPlaceholder_1(n)?e:_isPlaceholder_1(t)?_curry1_1(function(e){return r(e,n)}):_isPlaceholder_1(n)?_curry1_1(function(e){return r(t,e)}):r(t,n)}}}var _curry2_1=_curry2;function _curry3(r){return function e(t,n,i){switch(arguments.length){case 0:return e;case 1:return _isPlaceholder_1(t)?e:_curry2_1(function(e,n){return r(t,e,n)});case 2:return _isPlaceholder_1(t)&&_isPlaceholder_1(n)?e:_isPlaceholder_1(t)?_curry2_1(function(e,t){return r(e,n,t)}):_isPlaceholder_1(n)?_curry2_1(function(e,n){return r(t,e,n)}):_curry1_1(function(e){return r(t,n,e)});default:return _isPlaceholder_1(t)&&_isPlaceholder_1(n)&&_isPlaceholder_1(i)?e:_isPlaceholder_1(t)&&_isPlaceholder_1(n)?_curry2_1(function(e,t){return r(e,t,i)}):_isPlaceholder_1(t)&&_isPlaceholder_1(i)?_curry2_1(function(e,t){return r(e,n,t)}):_isPlaceholder_1(n)&&_isPlaceholder_1(i)?_curry2_1(function(e,n){return r(t,e,n)}):_isPlaceholder_1(t)?_curry1_1(function(e){return r(e,n,i)}):_isPlaceholder_1(n)?_curry1_1(function(e){return r(t,e,i)}):_isPlaceholder_1(i)?_curry1_1(function(e){return r(t,n,e)}):r(t,n,i)}}}var _curry3_1=_curry3;function _isObject(r){return"[object Object]"===Object.prototype.toString.call(r)}var _isObject_1=_isObject;function _has(r,e){return Object.prototype.hasOwnProperty.call(e,r)}var _has_1=_has,mergeWithKey=_curry3_1(function(r,e,t){var n,i={};for(n in e)_has_1(n,e)&&(i[n]=_has_1(n,t)?r(n,e[n],t[n]):e[n]);for(n in t)_has_1(n,t)&&!_has_1(n,i)&&(i[n]=t[n]);return i}),mergeWithKey_1=mergeWithKey,mergeDeepWithKey=_curry3_1(function r(e,t,n){return mergeWithKey_1(function(t,n,i){return _isObject_1(n)&&_isObject_1(i)?r(e,n,i):e(t,n,i)},t,n)}),mergeDeepWithKey_1=mergeDeepWithKey,mergeDeepRight=_curry2_1(function(r,e){return mergeDeepWithKey_1(function(r,e,t){return t},r,e)}),mergeDeepRight_1=mergeDeepRight,type=_curry1_1(function(r){return null===r?"Null":void 0===r?"Undefined":Object.prototype.toString.call(r).slice(8,-1)}),type_1=type,trim=ramda.curry(function(r,e){for(var t,n=null,i=null,a=0;a<e.length;a++)t=e[a],r.includes(t)?n&&(i=a):(null==n&&(n=a),i=null);return e.slice(n||0,i||e.length)}),unshield=ramda.compose(ramda.replace(/&/g,"\\&"),String),stringifyPair=function(r,e,t){switch(ramda.type(t)){case"Array":switch(r){case"[]":return ramda.compose(ramda.join("&"),ramda.reduce(function(t,n){return ramda.append(stringifyPair(r,e+"[]",n),t)},[]))(t);case",":return e+"="+ramda.compose(ramda.join(","),ramda.reduce(function(r,e){return ramda.append(unshield(e),r)},[]))(t)}default:return e+"="+unshield(t)}},formURI=function(r){var e=[];if(r.params){var t=[];Object.entries(r.params).forEach(function(e){var n=e[0],i=e[1];null!=i&&t.push(stringifyPair(r.handleArrays||"[]",n,i))}),t.length&&e.push("?"+t.join("&"))}return encodeURI((r.url||"")+e.map(trim("-")).join("/"))},trimSlash=trim("/"),addBase=function(r,e){return e.includes("://")||e.startsWith(r)?e:trimSlash(r)+"/"+trimSlash(e)},hole=function(r){return r},_this$1=null,default_config={base:"/",json:!0,headers:{},timeout:1e4,throwCodes:/\n/,credentials:"omit",handleArrays:"[]",middleware:{in:[],out:[]}},finalTransform=function(r){return"out"==r?hole:function(r){var e=r.query,t=r.response;return __awaiter(_this$1,void 0,void 0,function(){var r;return __generator(this,function(n){switch(n.label){case 0:return e.json?[4,t.json()]:[3,2];case 1:return r=n.sent(),[3,3];case 2:r=t,n.label=3;case 3:return[2,r]}})})}},Fetch=function(){function r(r){var e=this;void 0===r&&(r={}),this.middleware={in:[],out:[function(r){return __awaiter(e,void 0,void 0,function(){return __generator(this,function(e){return r.url=formURI(r),[2,r]})})},function(r){return __awaiter(e,void 0,void 0,function(){return __generator(this,function(e){return r.url=addBase(this.config.base,r.url),[2,r]})})},function(r){return __awaiter(e,void 0,void 0,function(){return __generator(this,function(e){return"Object"==type_1(r.body)&&((r=addHeaders({"Content-Type":"application/json"},r)).body=JSON.stringify(r.body)),[2,r]})})},function(r){return __awaiter(e,void 0,void 0,function(){var e;return __generator(this,function(t){for(e in r.headers)"Null"==type_1(r.headers[e])&&delete r.headers[e];return[2,r]})})}]},this.config=mergeDeepRight_1(default_config,r),this.basic_query={url:"",method:"get",headers:{},params:{},result:null,body:null,json:this.config.json,timeout:this.config.timeout,credentials:this.config.credentials,throwCodes:this.config.throwCodes,handleArrays:this.config.handleArrays,misc:{}};for(var t={},n=0,i=["in","out"];n<i.length;n++){var a=i[n];t[a]=asyncpipe.apply(void 0,[finalTransform(a)].concat(this.middleware[a],this.config.middleware[a]))}this.applyMiddleware=t}return r.prototype.query=function(r){return __awaiter(this,void 0,Promise,function(){var e,t=this;return __generator(this,function(n){switch(n.label){case 0:return[4,this.applyMiddleware.out(mergeDeepRight_1(this.basic_query,r))];case 1:return(r=n.sent()).result?[2,r.result]:(e={method:r.method,headers:r.headers,credentials:r.credentials},r.body&&(e.body=r.body),[2,new Promise(function(n,i){return __awaiter(t,void 0,void 0,function(){var t,a,o,c,u;return __generator(this,function(s){switch(s.label){case 0:t=!1,a=setTimeout(function(){t=!0,i("timeout")},r.timeout),s.label=1;case 1:return s.trys.push([1,6,,7]),[4,fetch(r.url,e)];case 2:return o=s.sent(),t?[3,5]:(clearTimeout(a),r.throwCodes.test(String(o.status))?(i(o.status),[3,5]):[3,3]);case 3:return c=n,[4,this.applyMiddleware.in({query:r,response:o})];case 4:c.apply(void 0,[s.sent()]),s.label=5;case 5:return[3,7];case 6:return u=s.sent(),clearTimeout(a),i(u),[3,7];case 7:return[2]}})})})])}})})},r}(),Cached=function(){function r(){this.cache={},this.proceccing={}}return r.prototype.tryCache=function(r,e){var t=this;return new Promise(function(n,i){t.cache[r]?n(t.cache[r]):t.proceccing[r]?t.proceccing[r].push({ff:n,rj:i}):(t.proceccing[r]=[{ff:n,rj:i}],e().then(function(e){t.cache[r]=e,t.proceccing[r].forEach(function(r){return(0,r.ff)(e)}),delete t.proceccing[r]}).catch(function(e){t.proceccing[r].forEach(function(r){return(0,r.rj)(e)})}))})},r}(),FetchError=function(){function r(r){this.pattern=/never/,this.name="Fetch",this.response=r}return Object.defineProperty(r.prototype,"type",{get:function(){return this.name.toLowerCase()},enumerable:!0,configurable:!0}),r.prototype.is=function(r){return this.pattern.test(String(r))},r.prototype.try=function(){var r=this.response;if(this.is(r.status))throw new Error("HTTP "+this.name+" error: status is "+r.status)},r}(),AccessError=function(r){function e(e){var t=r.call(this,e)||this;return t.pattern=/4\d[13]/,t.name="Access",t.try(),t}return __extends(e,r),e}(FetchError),ServerError=function(r){function e(e){var t=r.call(this,e)||this;return t.pattern=/5\d\d/,t.name="Server",t.try(),t}return __extends(e,r),e}(FetchError);exports.AccessError=AccessError,exports.Cached=Cached,exports.Fetch=Fetch,exports.ServerError=ServerError,exports.addHeaders=addHeaders,exports.asyncpipe=asyncpipe,exports.bind=bind,exports.clearEmpty=clearEmpty,exports.explore=explore,exports.forEach=forEach,exports.forEachAsync=forEachAsync,exports.formURI=formURI,exports.mapKeys=mapKeys,exports.waitAll=waitAll;
