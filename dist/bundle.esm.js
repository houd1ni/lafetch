import{curry as t,compose as n,replace as e,equals as r,fromPairs as o,map as i,split as u,join as c,filter as a,not as s,type as l,reduce as f,append as h,tap as p,bind as d,pickBy as y,unary as v,complement as g,isEmpty as b,isNil as m,toPairs as w,mergeDeepRight as j,assoc as P,T as O}from"ramda";var C=function(t,n){return(C=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)n.hasOwnProperty(e)&&(t[e]=n[e])})(t,n)};function _(t,n){function e(){this.constructor=t}C(t,n),t.prototype=null===n?Object.create(n):(e.prototype=n.prototype,new e)}var S=function(){return(S=Object.assign||function(t){for(var n,e=1,r=arguments.length;e<r;e++)for(var o in n=arguments[e])Object.prototype.hasOwnProperty.call(n,o)&&(t[o]=n[o]);return t}).apply(this,arguments)};function x(t,n,e,r){return new(e||(e=Promise))((function(o,i){function u(t){try{a(r.next(t))}catch(t){i(t)}}function c(t){try{a(r.throw(t))}catch(t){i(t)}}function a(t){t.done?o(t.value):new e((function(n){n(t.value)})).then(u,c)}a((r=r.apply(t,n||[])).next())}))}function A(t,n){var e,r,o,i,u={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(i){return function(c){return function(i){if(e)throw new TypeError("Generator is already executing.");for(;u;)try{if(e=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return u.label++,{value:i[1],done:!1};case 5:u.label++,r=i[1],i=[0];continue;case 7:i=u.ops.pop(),u.trys.pop();continue;default:if(!(o=(o=u.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){u=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){u.label=i[1];break}if(6===i[0]&&u.label<o[1]){u.label=o[1],o=i;break}if(o&&u.label<o[2]){u.label=o[2],u.ops.push(i);break}o[2]&&u.ops.pop(),u.trys.pop();continue}i=n.call(t,u)}catch(t){i=[6,t],r=0}finally{e=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,c])}}}function T(t){return null!=t&&"object"==typeof t&&!0===t["@@functional/placeholder"]}function q(t){return function n(e){return 0===arguments.length||T(e)?n:t.apply(this,arguments)}}function E(t,n){return Object.prototype.hasOwnProperty.call(n,t)}var k,M=q((function(t){var n=[];for(var e in t)E(e,t)&&(n[n.length]=[e,t[e]]);return n})),N=t((function(t,n){for(var e,r=null,o=null,i=0;i<n.length;i++)e=n[i],t.includes(e)?r&&(o=i):(null==r&&(r=i),o=null);return n.slice(r||0,o||n.length)})),W=n(e(/&/g,"\\&"),String),I=function(t,e,r){switch(l(r)){case"Array":switch(t){case"[]":return n(c("&"),f((function(n,r){return h(I(t,e+"[]",r),n)}),[]))(r);case",":return e+"="+n(c(","),f((function(t,n){return h(W(n),t)}),[]))(r)}default:return e+"="+W(r)}},R=t((function(t,n){var e=n.search(t);return~e?[n.slice(0,e),n.slice(e+1)]:[n]})),U=n((function(t){var n=t[0],e=n[0],i=n[1],u=t.slice(1);return{name:e,value:i,attrs:r(u,[null])?{}:o(u)}}),i(n((function(t){var n=t[0],e=t[1];return n?[n,!e||decodeURIComponent(e)]:null}),R(/=/))),u(/; ?/g)),F=n(c("; "),a(n(s,r("Null"),l)),i((function(t){var n=t[0],e=t[1];return null===e?null:!0===e?n:n+"="+e})),(function(t){var n=t.name,e=t.value,r=t.attrs;return[[n,e]].concat(M(r))})),G=function(t){var n=[];if(t.params){var e=[];Object.entries(t.params).forEach((function(n){var r=n[0],o=n[1];null!=o&&e.push(I(t.handleArrays||"[]",r,o))})),e.length&&n.push("?"+e.join("&"))}return encodeURI((t.url||"")+n.map(N("-")).join("/"))},H=N("/"),J=function(t,n){return n.includes("://")||n.startsWith(t)?n:H(t)+"/"+H(n)},L=function(t){return t},z=t((function(t,n){return S({},n,{headers:S({},n.headers,t)})})),B=(k=function(t,n,e){return x(null,void 0,void 0,(function(){return A(this,(function(r){switch(r.label){case 0:return e<n.length?[4,t(n[e])]:[3,3];case 1:return r.sent(),[4,k(t,n,++e)];case 2:r.sent(),r.label=3;case 3:return[2]}}))}))},t((function(t,n){return k(t,n,0)}))),D=t((function(t,n){return Promise.all(n.map(t))})),K=function(t){return Promise.all(t)},Q=p(d(console.log,console)),V=n(y,v,g)(b),X=function(n,e){return t(n[e].bind(n))},Y=t((function(t,e){return n(o,a(g(m)),i((function(n){var e=n[0],r=n[1];return null===t[e]?null:[t[e]||e,r]})),w)(e)})),Z=function(){var t=function(n,e,r){return x(null,void 0,Promise,(function(){var o,i,u;return A(this,(function(c){switch(c.label){case 0:return~r?(i=t,u=[n],[4,n[r](e)]):[3,3];case 1:return[4,i.apply(void 0,u.concat([c.sent(),--r]))];case 2:return o=c.sent(),[3,4];case 3:o=e,c.label=4;case 4:return[2,o]}}))}))};return function(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];return function(e){return t(n,e,n.length-1)}}}(),$=function(){function t(t){this.data=null,t?this.parse(t):this.data={name:"",value:null,attrs:{}}}return t.prototype.parse=function(t){return this.data=U(t),this.get()},t.prototype.get=function(){return this.data},t.prototype.set=function(t){this.data.value=t},t.prototype.stringify=function(){return F(this.data)},t.prototype.toString=function(){return this.stringify()},t}(),tt={base:"/",json:!0,headers:{},timeout:1e4,adapter:function(t,n){return fetch(t,n)},throwCodes:/\n/,credentials:"same-origin",handleArrays:"[]",encoding:"json",middleware:{in:[],out:[]}},nt=function(t){return"out"==t?L:function(t){var n=t.query,e=t.response;return x(null,void 0,void 0,(function(){var t;return A(this,(function(r){switch(r.label){case 0:return n.json?[4,e.json()]:[3,2];case 1:return t=r.sent(),[3,3];case 2:t=e,r.label=3;case 3:return[2,t]}}))}))}},et=function(){function t(t){var e=this;void 0===t&&(t={}),this.middleware={in:[],out:[function(t){return x(e,void 0,void 0,(function(){return A(this,(function(n){return t.url=G(t),[2,t]}))}))},function(t){return x(e,void 0,void 0,(function(){return A(this,(function(n){return t.url=J(this.config.base,t.url),[2,t]}))}))},function(t){return x(e,void 0,void 0,(function(){var e,r,o;return A(this,(function(i){if("Object"!=l(t.body))return[2,t];switch(e="Content-Type",t.encoding){case"json":return[2,n(z((r={},r[e]="application/json",r)),P("body",JSON.stringify(t.body)))(t)];case"url":return[2,n(z((o={},o[e]="application/x-www-form-urlencoded",o)),P("body",G({params:t.body}).slice(1)))(t)];case"multipart":console.warn("lafetch: multipart encoding is not implemented yet.");default:return[2,t]}return[2]}))}))},function(t){return x(e,void 0,void 0,(function(){var n;return A(this,(function(e){for(n in t.headers)"Null"==l(t.headers[n])&&delete t.headers[n];return[2,t]}))}))}]},this.config=j(tt,t),this.basic_query={url:"",method:"get",headers:{},params:{},result:null,body:null,json:this.config.json,timeout:this.config.timeout,credentials:this.config.credentials,throwCodes:this.config.throwCodes,handleArrays:this.config.handleArrays,encoding:this.config.encoding,misc:{}};for(var r={},o=0,i=["in","out"];o<i.length;o++){var u=i[o];r[u]=Z.apply(void 0,[nt(u)].concat(this.middleware[u],this.config.middleware[u]))}this.applyMiddleware=r}return t.prototype.query=function(t){return x(this,void 0,Promise,(function(){var n,e=this;return A(this,(function(r){switch(r.label){case 0:return[4,this.applyMiddleware.out(j(this.basic_query,t))];case 1:return(t=r.sent()).result?[2,t.result]:(n={method:t.method,headers:t.headers,credentials:t.credentials},t.body&&(n.body=t.body),[2,new Promise((function(r,o){return x(e,void 0,void 0,(function(){var e,i,u,c,a;return A(this,(function(s){switch(s.label){case 0:e=!1,i=setTimeout((function(){e=!0,o("timeout")}),t.timeout),s.label=1;case 1:return s.trys.push([1,6,,7]),[4,this.config.adapter(t.url,n)];case 2:return u=s.sent(),e?[3,5]:(clearTimeout(i),t.throwCodes.test(String(u.status))?(o(u.status),[3,5]):[3,3]);case 3:return c=r,[4,this.applyMiddleware.in({query:t,response:u})];case 4:c.apply(void 0,[s.sent()]),s.label=5;case 5:return[3,7];case 6:return a=s.sent(),clearTimeout(i),o(a),[3,7];case 7:return[2]}}))}))}))])}}))}))},t}(),rt=function(){function t(){this.cache={},this.proceccing={}}return t.prototype.tryCacheWhen=function(t,n,e){var r=this;return new Promise((function(o,i){r.cache[t]?o(r.cache[t]):r.proceccing[t]?r.proceccing[t].push({ff:o,rj:i}):(r.proceccing[t]=[{ff:o,rj:i}],e().then((function(e){n(e)&&(r.cache[t]=e),r.proceccing[t].forEach((function(t){return(0,t.ff)(e)})),delete r.proceccing[t]})).catch((function(n){r.proceccing[t].forEach((function(t){return(0,t.rj)(n)}))})))}))},t.prototype.tryCache=function(t,n){return this.tryCacheWhen(t,O,n)},t.prototype.dropCache=function(t){void 0===t&&(t=""),t?delete this.cache[t]:function(t){for(var n in t)delete t[n]}(this.cache)},t}(),ot=function(){function t(t){this.pattern=/never/,this.name="Fetch",this.response=t}return Object.defineProperty(t.prototype,"type",{get:function(){return this.name.toLowerCase()},enumerable:!0,configurable:!0}),t.prototype.is=function(t){return this.pattern.test(String(t))},t.prototype.try=function(){var t=this.response;if(this.is(t.status))throw new Error("HTTP "+this.name+" error: status is "+t.status)},t}(),it=function(t){function n(n){var e=t.call(this,n)||this;return e.pattern=/4\d[13]/,e.name="Access",e.try(),e}return _(n,t),n}(ot),ut=function(t){function n(n){var e=t.call(this,n)||this;return e.pattern=/5\d\d/,e.name="Server",e.try(),e}return _(n,t),n}(ot);export{it as AccessError,rt as Cached,$ as Cookie,et as Fetch,ut as ServerError,z as addHeaders,Z as asyncpipe,X as bind,V as clearEmpty,Q as explore,B as forEach,D as forEachAsync,G as formURI,Y as mapKeys,K as waitAll};
