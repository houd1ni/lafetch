import{curry as n,tap as t,bind as r,pickBy as e,unary as o,complement as u,isEmpty as i,compose as c,fromPairs as a,filter as s,isNil as f,map as l,toPairs as h}from"ramda";var p=function(n,t){return(p=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var r in t)t.hasOwnProperty(r)&&(n[r]=t[r])})(n,t)};function d(n,t){function r(){this.constructor=n}p(n,t),n.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}var v=function(){return(v=Object.assign||function(n){for(var t,r=1,e=arguments.length;r<e;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(n[o]=t[o]);return n}).apply(this,arguments)};function y(n,t,r,e){return new(r||(r=Promise))(function(o,u){function i(n){try{a(e.next(n))}catch(n){u(n)}}function c(n){try{a(e.throw(n))}catch(n){u(n)}}function a(n){n.done?o(n.value):new r(function(t){t(n.value)}).then(i,c)}a((e=e.apply(n,t||[])).next())})}function b(n,t){var r,e,o,u,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return u={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(u[Symbol.iterator]=function(){return this}),u;function c(u){return function(c){return function(u){if(r)throw new TypeError("Generator is already executing.");for(;i;)try{if(r=1,e&&(o=2&u[0]?e.return:u[0]?e.throw||((o=e.return)&&o.call(e),0):e.next)&&!(o=o.call(e,u[1])).done)return o;switch(e=0,o&&(u=[2&u[0],o.value]),u[0]){case 0:case 1:o=u;break;case 4:return i.label++,{value:u[1],done:!1};case 5:i.label++,e=u[1],u=[0];continue;case 7:u=i.ops.pop(),i.trys.pop();continue;default:if(!(o=(o=i.trys).length>0&&o[o.length-1])&&(6===u[0]||2===u[0])){i=0;continue}if(3===u[0]&&(!o||u[1]>o[0]&&u[1]<o[3])){i.label=u[1];break}if(6===u[0]&&i.label<o[1]){i.label=o[1],o=u;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(u);break}o[2]&&i.ops.pop(),i.trys.pop();continue}u=t.call(n,i)}catch(n){u=[6,n],e=0}finally{r=o=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}([u,c])}}}var g,m=n(function(n,t){return v({},t,{headers:Object.assign({},t.headers,n)})}),w=(g=function(n,t,r){return y(void 0,void 0,void 0,function(){return b(this,function(e){switch(e.label){case 0:return r<t.length?[4,n(t[r])]:[3,3];case 1:return e.sent(),[4,g(n,t,++r)];case 2:e.sent(),e.label=3;case 3:return[2]}})})},n(function(n,t){return g(n,t,0)})),j=n(function(n,t){return Promise.all(t.map(n))}),O=function(n){return Promise.all(n)},P=t(r(console.log,console)),_=e(o(u(i))),S=function(t,r){return n(t[r].bind(t))},C=n(function(n,t){return c(a,s(u(f)),l(function(t){var r=t[0],e=t[1];return null===n[r]?null:[n[r]||r,e]}),h)(t)}),T=function(){var n=function(t,r,e){return y(void 0,void 0,void 0,function(){var o,u,i,c;return b(this,function(a){switch(a.label){case 0:return~e?(o=t[e](r),u=n,i=[t],o instanceof Promise?[4,o]:[3,2]):[3,5];case 1:return c=a.sent(),[3,3];case 2:c=o,a.label=3;case 3:return[4,u.apply(void 0,i.concat([c,--e]))];case 4:return[2,a.sent()];case 5:return[2,r]}})})};return function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];return function(r){return n(t,r,t.length-1)}}}();var x=function(n){return null!=n&&"object"==typeof n&&!0===n["@@functional/placeholder"]};var q=function(n){return function t(r){return 0===arguments.length||x(r)?t:n.apply(this,arguments)}};var E=function(n){return function t(r,e){switch(arguments.length){case 0:return t;case 1:return x(r)?t:q(function(t){return n(r,t)});default:return x(r)&&x(e)?t:x(r)?q(function(t){return n(t,e)}):x(e)?q(function(t){return n(r,t)}):n(r,e)}}};var k=function(n){return function t(r,e,o){switch(arguments.length){case 0:return t;case 1:return x(r)?t:E(function(t,e){return n(r,t,e)});case 2:return x(r)&&x(e)?t:x(r)?E(function(t,r){return n(t,e,r)}):x(e)?E(function(t,e){return n(r,t,e)}):q(function(t){return n(r,e,t)});default:return x(r)&&x(e)&&x(o)?t:x(r)&&x(e)?E(function(t,r){return n(t,r,o)}):x(r)&&x(o)?E(function(t,r){return n(t,e,r)}):x(e)&&x(o)?E(function(t,e){return n(r,t,e)}):x(r)?q(function(t){return n(t,e,o)}):x(e)?q(function(t){return n(r,t,o)}):x(o)?q(function(t){return n(r,e,t)}):n(r,e,o)}}};var M=function(n){return"[object Object]"===Object.prototype.toString.call(n)};var N=function(n,t){return Object.prototype.hasOwnProperty.call(t,n)},A=k(function(n,t,r){var e,o={};for(e in t)N(e,t)&&(o[e]=N(e,r)?n(e,t[e],r[e]):t[e]);for(e in r)N(e,r)&&!N(e,o)&&(o[e]=r[e]);return o}),U=k(function n(t,r,e){return A(function(r,e,o){return M(e)&&M(o)?n(t,e,o):t(r,e,o)},r,e)}),F=E(function(n,t){return U(function(n,t,r){return r},n,t)}),G=q(function(n){return null===n?"Null":void 0===n?"Undefined":Object.prototype.toString.call(n).slice(8,-1)}),H=n(function(n,t){for(var r,e=null,o=null,u=0;u<t.length;u++)r=t[u],n.includes(r)?e&&(o=u):(null==e&&(e=u),o=null);return t.slice(e||0,o||t.length)}),I=function(n){var t=[];if(n.params){var r=[];Object.entries(n.params).forEach(function(n){var t=n[0],e=n[1];null!=e&&r.push(t+"="+String(e).replace(/&/g,"\\&"))}),r.length&&t.push("?"+r.join("&"))}return encodeURI((n.url||"")+t.map(H("-")).join("/"))},J=H("/"),L=function(n,t){return t.includes("://")||t.startsWith(n)?t:J(n)+"/"+J(t)},R=function(n){return n},W={base:"/",json:!0,headers:{},timeout:1e4,throwCodes:/\w/,credentials:"omit",middleware:{in:[],out:[]}},z=function(n){return"out"==n?R:function(n){var t=n.query,r=n.response;return y(void 0,void 0,void 0,function(){var n;return b(this,function(e){switch(e.label){case 0:return t.json?[4,r.json()]:[3,2];case 1:return n=e.sent(),[3,3];case 2:n=r,e.label=3;case 3:return[2,n]}})})}},B=function(){function n(n){var t=this;void 0===n&&(n={}),this.middleware={in:[],out:[function(n){return y(t,void 0,void 0,function(){return b(this,function(t){return n.url=I(n),[2,n]})})},function(n){return y(t,void 0,void 0,function(){return b(this,function(t){return n.url=L(this.config.base,n.url),[2,n]})})},function(n){return y(t,void 0,void 0,function(){return b(this,function(t){return"Object"==G(n.body)&&((n=m({"Content-Type":"application/json"},n)).body=JSON.stringify(n.body)),[2,n]})})},function(n){return y(t,void 0,void 0,function(){var t;return b(this,function(r){for(t in n.headers)"Null"==G(n.headers[t])&&delete n.headers[t];return[2,n]})})}]},this.config=F(W,n),this.basic_query={url:"",method:"get",headers:{},params:{},result:null,body:null,json:this.config.json,timeout:this.config.timeout,credentials:this.config.credentials,throwCodes:this.config.throwCodes,misc:{}};for(var r={},e=0,o=["in","out"];e<o.length;e++){var u=o[e];r[u]=T.apply(void 0,[z(u)].concat(this.middleware[u],this.config.middleware[u]))}this.applyMiddleware=r}return n.prototype.query=function(n){return y(this,void 0,void 0,function(){var t,r=this;return b(this,function(e){switch(e.label){case 0:return[4,this.applyMiddleware.out(F(this.basic_query,n))];case 1:return(n=e.sent()).result?[2,n.result]:(t={method:n.method,headers:n.headers,credentials:n.credentials},n.body&&(t.body=n.body),[2,new Promise(function(e,o){return y(r,void 0,void 0,function(){var r,u,i,c,a;return b(this,function(s){switch(s.label){case 0:r=!1,u=setTimeout(function(){r=!0,o("timeout")},n.timeout),s.label=1;case 1:return s.trys.push([1,6,,7]),[4,fetch(n.url,t)];case 2:return i=s.sent(),r?[3,5]:(clearTimeout(u),n.throwCodes.test(String(i.status))?(o(i.status),[3,5]):[3,3]);case 3:return c=e,[4,this.applyMiddleware.in({query:n,response:i})];case 4:c.apply(void 0,[s.sent()]),s.label=5;case 5:return[3,7];case 6:return a=s.sent(),clearTimeout(u),o(a),[3,7];case 7:return[2]}})})})])}})})},n}(),D=function(){function n(){this.cache={},this.proceccing={}}return n.prototype.tryCache=function(n,t){var r=this;return new Promise(function(e,o){r.cache[n]?e(r.cache[n]):r.proceccing[n]?r.proceccing[n].push({ff:e,rj:o}):(r.proceccing[n]=[{ff:e,rj:o}],t().then(function(t){r.cache[n]=t,r.proceccing[n].forEach(function(n){return(0,n.ff)(t)}),delete r.proceccing[n]}).catch(function(t){r.proceccing[n].forEach(function(n){return(0,n.rj)(t)})}))})},n}(),K=function(){function n(n){this.pattern=/never/,this.name="Fetch",this.response=n}return Object.defineProperty(n.prototype,"type",{get:function(){return this.name.toLowerCase()},enumerable:!0,configurable:!0}),n.prototype.is=function(n){return this.pattern.test(String(n))},n.prototype.try=function(){var n=this.response;if(this.is(n.status))throw new Error("HTTP "+this.name+" error: status is "+n.status)},n}(),Q=function(n){function t(t){var r=n.call(this,t)||this;return r.pattern=/4\d[13]/,r.name="Access",r.try(),r}return d(t,n),t}(K),V=function(n){function t(t){var r=n.call(this,t)||this;return r.pattern=/5\d\d/,r.name="Server",r.try(),r}return d(t,n),t}(K);export{Q as AccessError,D as Cached,B as Fetch,V as ServerError,m as addHeaders,T as asyncpipe,S as bind,_ as clearEmpty,P as explore,w as forEach,j as forEachAsync,I as formURI,C as mapKeys,O as waitAll};
