import{curry as n,tap as t,bind as r,pickBy as e,unary as u,complement as o,isEmpty as i,compose as c,fromPairs as a,filter as s,isNil as l,map as f,toPairs as h,replace as p,type as d,join as y,reduce as v,append as b}from"ramda";var g=function(n,t){return(g=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var r in t)t.hasOwnProperty(r)&&(n[r]=t[r])})(n,t)};function m(n,t){function r(){this.constructor=n}g(n,t),n.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}var w=function(){return(w=Object.assign||function(n){for(var t,r=1,e=arguments.length;r<e;r++)for(var u in t=arguments[r])Object.prototype.hasOwnProperty.call(t,u)&&(n[u]=t[u]);return n}).apply(this,arguments)};function j(n,t,r,e){return new(r||(r=Promise))(function(u,o){function i(n){try{a(e.next(n))}catch(n){o(n)}}function c(n){try{a(e.throw(n))}catch(n){o(n)}}function a(n){n.done?u(n.value):new r(function(t){t(n.value)}).then(i,c)}a((e=e.apply(n,t||[])).next())})}function O(n,t){var r,e,u,o,i={label:0,sent:function(){if(1&u[0])throw u[1];return u[1]},trys:[],ops:[]};return o={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function c(o){return function(c){return function(o){if(r)throw new TypeError("Generator is already executing.");for(;i;)try{if(r=1,e&&(u=2&o[0]?e.return:o[0]?e.throw||((u=e.return)&&u.call(e),0):e.next)&&!(u=u.call(e,o[1])).done)return u;switch(e=0,u&&(o=[2&o[0],u.value]),o[0]){case 0:case 1:u=o;break;case 4:return i.label++,{value:o[1],done:!1};case 5:i.label++,e=o[1],o=[0];continue;case 7:o=i.ops.pop(),i.trys.pop();continue;default:if(!(u=(u=i.trys).length>0&&u[u.length-1])&&(6===o[0]||2===o[0])){i=0;continue}if(3===o[0]&&(!u||o[1]>u[0]&&o[1]<u[3])){i.label=o[1];break}if(6===o[0]&&i.label<u[1]){i.label=u[1],u=o;break}if(u&&i.label<u[2]){i.label=u[2],i.ops.push(o);break}u[2]&&i.ops.pop(),i.trys.pop();continue}o=t.call(n,i)}catch(n){o=[6,n],e=0}finally{r=u=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,c])}}}var P,_=n(function(n,t){return w({},t,{headers:Object.assign({},t.headers,n)})}),S=(P=function(n,t,r){return j(null,void 0,void 0,function(){return O(this,function(e){switch(e.label){case 0:return r<t.length?[4,n(t[r])]:[3,3];case 1:return e.sent(),[4,P(n,t,++r)];case 2:e.sent(),e.label=3;case 3:return[2]}})})},n(function(n,t){return P(n,t,0)})),A=n(function(n,t){return Promise.all(t.map(n))}),C=function(n){return Promise.all(n)},T=t(r(console.log,console)),x=e(u(o(i))),q=function(t,r){return n(t[r].bind(t))},E=n(function(n,t){return c(a,s(o(l)),f(function(t){var r=t[0],e=t[1];return null===n[r]?null:[n[r]||r,e]}),h)(t)}),k=function(){var n=function(t,r,e){return j(null,void 0,Promise,function(){var u,o,i,c;return O(this,function(a){switch(a.label){case 0:return~e?(u=t[e](r),o=n,i=[t],u instanceof Promise?[4,u]:[3,2]):[3,5];case 1:return c=a.sent(),[3,3];case 2:c=u,a.label=3;case 3:return[4,o.apply(void 0,i.concat([c,--e]))];case 4:return[2,a.sent()];case 5:return[2,r]}})})};return function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];return function(r){return n(t,r,t.length-1)}}}();var M=function(n){return null!=n&&"object"==typeof n&&!0===n["@@functional/placeholder"]};var N=function(n){return function t(r){return 0===arguments.length||M(r)?t:n.apply(this,arguments)}};var U=function(n){return function t(r,e){switch(arguments.length){case 0:return t;case 1:return M(r)?t:N(function(t){return n(r,t)});default:return M(r)&&M(e)?t:M(r)?N(function(t){return n(t,e)}):M(e)?N(function(t){return n(r,t)}):n(r,e)}}};var F=function(n){return function t(r,e,u){switch(arguments.length){case 0:return t;case 1:return M(r)?t:U(function(t,e){return n(r,t,e)});case 2:return M(r)&&M(e)?t:M(r)?U(function(t,r){return n(t,e,r)}):M(e)?U(function(t,e){return n(r,t,e)}):N(function(t){return n(r,e,t)});default:return M(r)&&M(e)&&M(u)?t:M(r)&&M(e)?U(function(t,r){return n(t,r,u)}):M(r)&&M(u)?U(function(t,r){return n(t,e,r)}):M(e)&&M(u)?U(function(t,e){return n(r,t,e)}):M(r)?N(function(t){return n(t,e,u)}):M(e)?N(function(t){return n(r,t,u)}):M(u)?N(function(t){return n(r,e,t)}):n(r,e,u)}}};var G=function(n){return"[object Object]"===Object.prototype.toString.call(n)};var H=function(n,t){return Object.prototype.hasOwnProperty.call(t,n)},I=F(function(n,t,r){var e,u={};for(e in t)H(e,t)&&(u[e]=H(e,r)?n(e,t[e],r[e]):t[e]);for(e in r)H(e,r)&&!H(e,u)&&(u[e]=r[e]);return u}),J=F(function n(t,r,e){return I(function(r,e,u){return G(e)&&G(u)?n(t,e,u):t(r,e,u)},r,e)}),L=U(function(n,t){return J(function(n,t,r){return r},n,t)}),R=N(function(n){return null===n?"Null":void 0===n?"Undefined":Object.prototype.toString.call(n).slice(8,-1)}),W=n(function(n,t){for(var r,e=null,u=null,o=0;o<t.length;o++)r=t[o],n.includes(r)?e&&(u=o):(null==e&&(e=o),u=null);return t.slice(e||0,u||t.length)}),z=c(p(/&/g,"\\&"),String),B=function(n,t,r){switch(d(r)){case"Array":switch(n){case"[]":return c(y("&"),v(function(r,e){return b(B(n,t+"[]",e),r)},[]))(r);case",":return c(y(","),v(function(n,t){return b(z(t),n)},[]))(r)}default:return t+"="+z(r)}},D=function(n){var t=[];if(n.params){var r=[];Object.entries(n.params).forEach(function(t){var e=t[0],u=t[1];null!=u&&r.push(B(n.handleArrays||"[]",e,u))}),r.length&&t.push("?"+r.join("&"))}return encodeURI((n.url||"")+t.map(W("-")).join("/"))},K=W("/"),Q=function(n,t){return t.includes("://")||t.startsWith(n)?t:K(n)+"/"+K(t)},V=function(n){return n},X={base:"/",json:!0,headers:{},timeout:1e4,throwCodes:/\n/,credentials:"omit",handleArrays:"[]",middleware:{in:[],out:[]}},Y=function(n){return"out"==n?V:function(n){var t=n.query,r=n.response;return j(null,void 0,void 0,function(){var n;return O(this,function(e){switch(e.label){case 0:return t.json?[4,r.json()]:[3,2];case 1:return n=e.sent(),[3,3];case 2:n=r,e.label=3;case 3:return[2,n]}})})}},Z=function(){function n(n){var t=this;void 0===n&&(n={}),this.middleware={in:[],out:[function(n){return j(t,void 0,void 0,function(){return O(this,function(t){return n.url=D(n),[2,n]})})},function(n){return j(t,void 0,void 0,function(){return O(this,function(t){return n.url=Q(this.config.base,n.url),[2,n]})})},function(n){return j(t,void 0,void 0,function(){return O(this,function(t){return"Object"==R(n.body)&&((n=_({"Content-Type":"application/json"},n)).body=JSON.stringify(n.body)),[2,n]})})},function(n){return j(t,void 0,void 0,function(){var t;return O(this,function(r){for(t in n.headers)"Null"==R(n.headers[t])&&delete n.headers[t];return[2,n]})})}]},this.config=L(X,n),this.basic_query={url:"",method:"get",headers:{},params:{},result:null,body:null,json:this.config.json,timeout:this.config.timeout,credentials:this.config.credentials,throwCodes:this.config.throwCodes,handleArrays:this.config.handleArrays,misc:{}};for(var r={},e=0,u=["in","out"];e<u.length;e++){var o=u[e];r[o]=k.apply(void 0,[Y(o)].concat(this.middleware[o],this.config.middleware[o]))}this.applyMiddleware=r}return n.prototype.query=function(n){return j(this,void 0,Promise,function(){var t,r=this;return O(this,function(e){switch(e.label){case 0:return[4,this.applyMiddleware.out(L(this.basic_query,n))];case 1:return(n=e.sent()).result?[2,n.result]:(t={method:n.method,headers:n.headers,credentials:n.credentials},n.body&&(t.body=n.body),[2,new Promise(function(e,u){return j(r,void 0,void 0,function(){var r,o,i,c,a;return O(this,function(s){switch(s.label){case 0:r=!1,o=setTimeout(function(){r=!0,u("timeout")},n.timeout),s.label=1;case 1:return s.trys.push([1,6,,7]),[4,fetch(n.url,t)];case 2:return i=s.sent(),r?[3,5]:(clearTimeout(o),n.throwCodes.test(String(i.status))?(u(i.status),[3,5]):[3,3]);case 3:return c=e,[4,this.applyMiddleware.in({query:n,response:i})];case 4:c.apply(void 0,[s.sent()]),s.label=5;case 5:return[3,7];case 6:return a=s.sent(),clearTimeout(o),u(a),[3,7];case 7:return[2]}})})})])}})})},n}(),$=function(){function n(){this.cache={},this.proceccing={}}return n.prototype.tryCache=function(n,t){var r=this;return new Promise(function(e,u){r.cache[n]?e(r.cache[n]):r.proceccing[n]?r.proceccing[n].push({ff:e,rj:u}):(r.proceccing[n]=[{ff:e,rj:u}],t().then(function(t){r.cache[n]=t,r.proceccing[n].forEach(function(n){return(0,n.ff)(t)}),delete r.proceccing[n]}).catch(function(t){r.proceccing[n].forEach(function(n){return(0,n.rj)(t)})}))})},n}(),nn=function(){function n(n){this.pattern=/never/,this.name="Fetch",this.response=n}return Object.defineProperty(n.prototype,"type",{get:function(){return this.name.toLowerCase()},enumerable:!0,configurable:!0}),n.prototype.is=function(n){return this.pattern.test(String(n))},n.prototype.try=function(){var n=this.response;if(this.is(n.status))throw new Error("HTTP "+this.name+" error: status is "+n.status)},n}(),tn=function(n){function t(t){var r=n.call(this,t)||this;return r.pattern=/4\d[13]/,r.name="Access",r.try(),r}return m(t,n),t}(nn),rn=function(n){function t(t){var r=n.call(this,t)||this;return r.pattern=/5\d\d/,r.name="Server",r.try(),r}return m(t,n),t}(nn);export{tn as AccessError,$ as Cached,Z as Fetch,rn as ServerError,_ as addHeaders,k as asyncpipe,q as bind,x as clearEmpty,T as explore,S as forEach,A as forEachAsync,D as formURI,E as mapKeys,C as waitAll};
