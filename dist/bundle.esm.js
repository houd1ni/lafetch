import{curry as t,tap as n,bind as e,pickBy as r,unary as o,complement as i,isEmpty as u,compose as c,fromPairs as a,filter as s,isNil as l,map as f,toPairs as h,replace as d,type as p,join as y,reduce as v,append as b,mergeDeepRight as m,T as g}from"ramda";var w=function(t,n){return(w=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)n.hasOwnProperty(e)&&(t[e]=n[e])})(t,n)};function j(t,n){function e(){this.constructor=t}w(t,n),t.prototype=null===n?Object.create(n):(e.prototype=n.prototype,new e)}var O=function(){return(O=Object.assign||function(t){for(var n,e=1,r=arguments.length;e<r;e++)for(var o in n=arguments[e])Object.prototype.hasOwnProperty.call(n,o)&&(t[o]=n[o]);return t}).apply(this,arguments)};function P(t,n,e,r){return new(e||(e=Promise))((function(o,i){function u(t){try{a(r.next(t))}catch(t){i(t)}}function c(t){try{a(r.throw(t))}catch(t){i(t)}}function a(t){t.done?o(t.value):new e((function(n){n(t.value)})).then(u,c)}a((r=r.apply(t,n||[])).next())}))}function C(t,n){var e,r,o,i,u={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(i){return function(c){return function(i){if(e)throw new TypeError("Generator is already executing.");for(;u;)try{if(e=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return u.label++,{value:i[1],done:!1};case 5:u.label++,r=i[1],i=[0];continue;case 7:i=u.ops.pop(),u.trys.pop();continue;default:if(!(o=(o=u.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){u=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){u.label=i[1];break}if(6===i[0]&&u.label<o[1]){u.label=o[1],o=i;break}if(o&&u.label<o[2]){u.label=o[2],u.ops.push(i);break}o[2]&&u.ops.pop(),u.trys.pop();continue}i=n.call(t,u)}catch(t){i=[6,t],r=0}finally{e=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,c])}}}var _,A=t((function(t,n){return O({},n,{headers:Object.assign({},n.headers,t)})})),S=(_=function(t,n,e){return P(null,void 0,void 0,(function(){return C(this,(function(r){switch(r.label){case 0:return e<n.length?[4,t(n[e])]:[3,3];case 1:return r.sent(),[4,_(t,n,++e)];case 2:r.sent(),r.label=3;case 3:return[2]}}))}))},t((function(t,n){return _(t,n,0)}))),T=t((function(t,n){return Promise.all(n.map(t))})),x=function(t){return Promise.all(t)},q=n(e(console.log,console)),E=r(o(i(u))),k=function(n,e){return t(n[e].bind(n))},M=t((function(t,n){return c(a,s(i(l)),f((function(n){var e=n[0],r=n[1];return null===t[e]?null:[t[e]||e,r]})),h)(n)})),W=function(){var t=function(n,e,r){return P(null,void 0,Promise,(function(){var o,i,u;return C(this,(function(c){switch(c.label){case 0:return~r?(i=t,u=[n],[4,n[r](e)]):[3,3];case 1:return[4,i.apply(void 0,u.concat([c.sent(),--r]))];case 2:return o=c.sent(),[3,4];case 3:o=e,c.label=4;case 4:return[2,o]}}))}))};return function(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];return function(e){return t(n,e,n.length-1)}}}(),N=t((function(t,n){for(var e,r=null,o=null,i=0;i<n.length;i++)e=n[i],t.includes(e)?r&&(o=i):(null==r&&(r=i),o=null);return n.slice(r||0,o||n.length)})),F=c(d(/&/g,"\\&"),String),G=function(t,n,e){switch(p(e)){case"Array":switch(t){case"[]":return c(y("&"),v((function(e,r){return b(G(t,n+"[]",r),e)}),[]))(e);case",":return n+"="+c(y(","),v((function(t,n){return b(F(n),t)}),[]))(e)}default:return n+"="+F(e)}},H=function(t){var n=[];if(t.params){var e=[];Object.entries(t.params).forEach((function(n){var r=n[0],o=n[1];null!=o&&e.push(G(t.handleArrays||"[]",r,o))})),e.length&&n.push("?"+e.join("&"))}return encodeURI((t.url||"")+n.map(N("-")).join("/"))},I=N("/"),J=function(t,n){return n.includes("://")||n.startsWith(t)?n:I(t)+"/"+I(n)},L=function(t){return t},R={base:"/",json:!0,headers:{},timeout:1e4,adapter:function(t,n){return fetch(t,n)},throwCodes:/\n/,credentials:"same-origin",handleArrays:"[]",middleware:{in:[],out:[]}},U=function(t){return"out"==t?L:function(t){var n=t.query,e=t.response;return P(null,void 0,void 0,(function(){var t;return C(this,(function(r){switch(r.label){case 0:return n.json?[4,e.json()]:[3,2];case 1:return t=r.sent(),[3,3];case 2:t=e,r.label=3;case 3:return[2,t]}}))}))}},z=function(){function t(t){var n=this;void 0===t&&(t={}),this.middleware={in:[],out:[function(t){return P(n,void 0,void 0,(function(){return C(this,(function(n){return t.url=H(t),[2,t]}))}))},function(t){return P(n,void 0,void 0,(function(){return C(this,(function(n){return t.url=J(this.config.base,t.url),[2,t]}))}))},function(t){return P(n,void 0,void 0,(function(){return C(this,(function(n){return"Object"==p(t.body)&&((t=A({"Content-Type":"application/json"},t)).body=JSON.stringify(t.body)),[2,t]}))}))},function(t){return P(n,void 0,void 0,(function(){var n;return C(this,(function(e){for(n in t.headers)"Null"==p(t.headers[n])&&delete t.headers[n];return[2,t]}))}))}]},this.config=m(R,t),this.basic_query={url:"",method:"get",headers:{},params:{},result:null,body:null,json:this.config.json,timeout:this.config.timeout,credentials:this.config.credentials,throwCodes:this.config.throwCodes,handleArrays:this.config.handleArrays,misc:{}};for(var e={},r=0,o=["in","out"];r<o.length;r++){var i=o[r];e[i]=W.apply(void 0,[U(i)].concat(this.middleware[i],this.config.middleware[i]))}this.applyMiddleware=e}return t.prototype.query=function(t){return P(this,void 0,Promise,(function(){var n,e=this;return C(this,(function(r){switch(r.label){case 0:return[4,this.applyMiddleware.out(m(this.basic_query,t))];case 1:return(t=r.sent()).result?[2,t.result]:(n={method:t.method,headers:t.headers,credentials:t.credentials},t.body&&(n.body=t.body),[2,new Promise((function(r,o){return P(e,void 0,void 0,(function(){var e,i,u,c,a;return C(this,(function(s){switch(s.label){case 0:e=!1,i=setTimeout((function(){e=!0,o("timeout")}),t.timeout),s.label=1;case 1:return s.trys.push([1,6,,7]),[4,this.config.adapter(t.url,n)];case 2:return u=s.sent(),e?[3,5]:(clearTimeout(i),t.throwCodes.test(String(u.status))?(o(u.status),[3,5]):[3,3]);case 3:return c=r,[4,this.applyMiddleware.in({query:t,response:u})];case 4:c.apply(void 0,[s.sent()]),s.label=5;case 5:return[3,7];case 6:return a=s.sent(),clearTimeout(i),o(a),[3,7];case 7:return[2]}}))}))}))])}}))}))},t}(),B=function(){function t(){this.cache={},this.proceccing={}}return t.prototype.tryCacheWhen=function(t,n,e){var r=this;return new Promise((function(o,i){r.cache[t]?o(r.cache[t]):r.proceccing[t]?r.proceccing[t].push({ff:o,rj:i}):(r.proceccing[t]=[{ff:o,rj:i}],e().then((function(e){n(e)&&(r.cache[t]=e),r.proceccing[t].forEach((function(t){return(0,t.ff)(e)})),delete r.proceccing[t]})).catch((function(n){r.proceccing[t].forEach((function(t){return(0,t.rj)(n)}))})))}))},t.prototype.tryCache=function(t,n){return this.tryCacheWhen(t,g,n)},t.prototype.dropCache=function(t){void 0===t&&(t=""),t?delete this.cache[t]:function(t){for(var n in t)delete t[n]}(this.cache)},t}(),D=function(){function t(t){this.pattern=/never/,this.name="Fetch",this.response=t}return Object.defineProperty(t.prototype,"type",{get:function(){return this.name.toLowerCase()},enumerable:!0,configurable:!0}),t.prototype.is=function(t){return this.pattern.test(String(t))},t.prototype.try=function(){var t=this.response;if(this.is(t.status))throw new Error("HTTP "+this.name+" error: status is "+t.status)},t}(),K=function(t){function n(n){var e=t.call(this,n)||this;return e.pattern=/4\d[13]/,e.name="Access",e.try(),e}return j(n,t),n}(D),Q=function(t){function n(n){var e=t.call(this,n)||this;return e.pattern=/5\d\d/,e.name="Server",e.try(),e}return j(n,t),n}(D);export{K as AccessError,B as Cached,z as Fetch,Q as ServerError,A as addHeaders,W as asyncpipe,k as bind,E as clearEmpty,q as explore,S as forEach,T as forEachAsync,H as formURI,M as mapKeys,x as waitAll};
